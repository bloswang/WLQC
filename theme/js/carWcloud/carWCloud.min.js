function CarWCloud(t,a){this.dom=t,this.imgSrc=a,this.axis=[],this._init(),this.keyName="name",this.valueName="value"}function Rectangle(t,a){this.tlp=t,this.lrp=a}CarWCloud.prototype={_init:function(){this.dom.childNodes[0]&&this.dom.removeChild(this.dom.childNodes[0]);var t=document.createElement("canvas"),a=document.createTextNode("sorry!您的浏览器版本太低...");if(t.appendChild(a),t.width=this.dom.offsetWidth,t.height=this.dom.offsetHeight,this.dom.appendChild(t),this.canvas=t,t.getContext){this.ctx=t.getContext("2d")}},_sort:function(){return this.data.sort(function(t,a){return parseInt(t[this.valueName])>parseInt(a[this.valueName])?-1:parseInt(t[this.valueName])<parseInt(a[this.valueName])?1:0})},draw:function(t){if(null==t||0==t.length)throw new Error("data can not be empty");t[0].word&&(this.keyName="word",this.valueName="heat"),this.data=t;var a=new Image,e=this;a.src=e.imgSrc,a.onload=function(){var t=e.canvas,i=a.width/t.width,n=a.height/i,r=(t.height-n)/2;e.ctx.drawImage(this,0,r,t.width,n),e._drawText()}},_drawText:function(){this.ctx.translate(this.canvas.width/2,this.canvas.height/2);var t,a=this._sort();t=a.length>2?this._sum()/(a.length-2):a[0][this.valueName];var e,i=0,n=this,r=["#4e4b4e","#ff6f40"];e=setInterval(function(){if(i<a.length){n.ctx.save(),n.ctx.fillStyle=i%2==0?r[0]:r[1];var s=a[i][n.valueName]/t*10;s=s>30?30:s<8?8:s;var h=s+"pt 微软雅黑";n.ctx.font=h;for(var o,l,c=a[i][n.keyName],d=n.ctx.measureText(c).width,u=s,v=0;;v++){o=n._normalInt(-n.canvas.width/2,n.canvas.width/2,10/(i+1))-d/2,l=n._normalInt(-n.canvas.height/2,n.canvas.height/2,10/(i+1))+u/2;var f={},m={};f.x=o+n.canvas.width/2,f.y=l-u+n.canvas.height/2,m.x=f.x+d+3,m.y=f.y+u+3;var x=new Rectangle(f,m);if(!n._collision(n.ctx.getImageData(f.x,f.y,d+3,u+3),x)){n.axis.push(x),n.ctx.fillText(c,o,l),n.ctx.restore(),i++;break}if(v>200){i++;break}}}else clearInterval(e)},50)},_normalInt:function(t,a,e){e=0==e?1:e;for(var i=[],n=0;n<e;n++)i[n]=Math.random();return Math.floor(i.reduce(function(t,a){return t+a})/e*(a-t))+t},_collision:function(t,a){for(var e=0;e<this.axis.length;e++)if(this.isRectOverlap(a,this.axis[e]))return!0;for(var i=t.data,e=0;e<i.length;e+=4)if(213!=i[e]||241!=i[e+1]||255!=i[e+2]||255!=i[e+3])return!0;return!1},_sum:function(){for(var t=0,a=1;a<this.data.length-1;a++)t+=parseInt(this.data[a][this.valueName]);return t},getDataURL:function(){return this.canvas.toDataURL()},isRectOverlap:function(t,a){return!(t.tlp.x>a.lrp.x|t.lrp.x<a.tlp.x|t.lrp.y<a.tlp.y|t.tlp.y>a.lrp.y)}};